<!DOCTYPE html>

<html lang = "en">
    <head>
        <meta charset = "UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">    
            <title>UMSA Jeopardy Game</title>
            <link rel="stylesheet" href="../static/css/styles.css">
            <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
            <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
        </head>

        <body>
            <button id="reset-button">Reset</button>
            <div class = "main-content">
                <h1>UMSA Jeopardy Game <img class="logo-img" src="../static/images/logo.jpeg" alt="UMSA Logo"></h1>
                <table>
                    <tr>
                        <th>Location</th>
                        <th>Movies</th>
                        <th>Food</th>
                        <th>New Zealand</th>
                        <th>Misc</th>
                    </tr>
                    <tr>
                        <td class="c1question" data-value="100">100</td>
                        <td class="c2question" data-value="100">100</td>
                        <td class="c3question" data-value="100">100</td>
                        <td class="c4question" data-value="100">100</td>
                        <td class="c5question" data-value="100">100</td>
                    </tr>
                    <tr>
                        <td class="c1question" data-value="200">200</td>
                        <td class="c2question" data-value="200">200</td>
                        <td class="c3question" data-value="200">200</td>
                        <td class="c4question" data-value="200">200</td>
                        <td class="c5question" data-value="200">200</td>
                    </tr>
                    <tr>
                        <td class="c1question" data-value="300">300</td>
                        <td class="c2question" data-value="300">300</td>
                        <td class="c3question" data-value="300">300</td>
                        <td class="c4question" data-value="300">300</td>
                        <td class="c5question" data-value="300">300</td>
                    </tr>
                    <tr>
                        <td class="c1question" data-value="400">400</td>
                        <td class="c2question" data-value="400">400</td>
                        <td class="c3question" data-value="400">400</td>
                        <td class="c4question" data-value="400">400</td>
                        <td class="c5question" data-value="400">400</td>
                    </tr>
                    <tr>
                        <td class="c1question" data-value="500">500</td>
                        <td class="c2question" data-value="500">500</td>
                        <td class="c3question" data-value="500">500</td>
                        <td class="c4question" data-value="500">500</td>
                        <td class="c5question" data-value="500">500</td>
                    </tr>
                </table>
            </div>
        </body>

    </html>

    <script type='text/javascript'>
        document.addEventListener('DOMContentLoaded', function() {
            // Get the clickedQuestions object from local storage
            var clickedQuestions = JSON.parse(localStorage.getItem('clickedQuestions')) || {};

            // Get the dailyDouble object from local storage
            var dailyDouble = JSON.parse(localStorage.getItem('dailyDouble'));

            // Add event listeners to the question elements
            var questions = document.querySelectorAll('[class$="question"]');

        // Check if a Daily Double has already been selected
        if (!dailyDouble) {
            // Randomly select a cell to be the Daily Double
            dailyDouble = questions[Math.floor(Math.random() * questions.length)];
            // Save the dailyDouble object in local storage
            localStorage.setItem('dailyDouble', JSON.stringify({
                value: dailyDouble.getAttribute('data-value'),
                category: dailyDouble.className.match(/c\d+/)[0]+'question'
            }));
        } else {
            // // Print out the value and category retrieved from local storage
            // console.log('Value from local storage:', dailyDouble.value);
            // console.log('Category from local storage:', dailyDouble.category);
            // Find the existing Daily Double element
            dailyDouble = document.querySelector('.' + dailyDouble.category + '[data-value="' + dailyDouble.value + '"]');

            // // Print out the result of the querySelector method
            // console.log('Result of querySelector:', dailyDouble);
        }
;
            for (var i = 0; i < questions.length; i++) {
                // Check if the question has already been clicked
                var questionId = questions[i].getAttribute('data-value') + '-' + questions[i].className;
                if (questionId in clickedQuestions) {
                    // Change the background color of the question element
                    if (Math.floor(i / 5) % 2 == 0) {
                        questions[i].style.backgroundColor = 'red';
                        questions[i].style.color = 'red';
                    } else {
                        questions[i].style.backgroundColor = 'white';
                        questions[i].style.color = 'white';
                    }
                    // Disable clicking on the question element
                    questions[i].style.pointerEvents = 'none';
                }

                // Add a click event listener to the question
                questions[i].addEventListener('click', function() {
                    // Check if the question has already been clicked
                    if (this.classList.contains('clicked')) {
                        return;

                    }

                    // Mark the question as clicked
                    this.classList.add('clicked');

                    // Save the clicked state of the question in local storage
                    var value = this.getAttribute('data-value');
                    var category = this.className.match(/c\d+/)[0];
                    var questionId = value + '-' + category + 'question';
                    clickedQuestions[questionId] = true;
                    localStorage.setItem('clickedQuestions', JSON.stringify(clickedQuestions));

                    // Check if the clicked question is the Daily Double
                    if (this.classList.contains('daily-double')) {
                        // Redirect the user to the daily double page instead of the question page
                        window.location.href = '/daily_double?value=' + value + '&category=' + category;
                    } else {
                        // Redirect the user to the question page
                        window.location.href = '/question?value=' + value + '&category=' + category;
                    }              
                });
                    // Initialize a counter for each category
                    var categoryCounts = localStorage.getItem('categoryCounts');
                    if (categoryCounts) {
                        categoryCounts = JSON.parse(categoryCounts);
                    } else {
                        // Initialize a counter for each category
                        categoryCounts = {
                            'c1question': 0,
                            'c2question': 0,
                            'c3question': 0,
                            'c4question': 0,
                            'c5question': 0
                        };
                    }

                    // Loop through the clickedQuestions object
                    for (var questionId in clickedQuestions) {
                        // Extract the category from the questionId
                        var category = questionId.split('-')[1];

                        // Increment the counter for this category
                        categoryCounts[category]++;
                    }

                    var redirect = false;
                    var redirectCategory;

                    // Check if any category has 5 clicked questions
                    for (var category in categoryCounts) {
                        if (categoryCounts[category] == 5) {
                            console.log('All questions in the ' + category + ' column have been clicked');
                            redirect = true;
                            redirectCategory = category.replace('question', ''); // This will remove 'question' from the category
                            break; // This will exit the loop as soon as a category with 5 clicked questions is found
                            categoryCounts = {
                                'c1question': 0,
                                'c2question': 0,
                                'c3question': 0,
                                'c4question': 0,
                                'c5question': 0
                            };
                        }
                    }

                    if (redirect) {
                    // Reset the count for the redirectCategory
                    categoryCounts[redirectCategory + 'question'] = 0;

                    // Save the reset categoryCounts to localStorage
                    localStorage.setItem('categoryCounts', JSON.stringify(categoryCounts));

                    // Redirect to the new page
                    window.location.replace('/column_filled?value=1000' + '&category=' + redirectCategory);
                }
}

        // Add a 'daily-double' class to the selected cell
        if (dailyDouble) {
            dailyDouble.classList.add('daily-double');
        } else {
            console.error('No element found for Daily Double');
        }

            // Add an event listener to the reset button
            var resetButton = document.getElementById('reset-button');
            resetButton.addEventListener('click', function() {
                // Clear the clickedQuestions object from local storage
                localStorage.removeItem('clickedQuestions');

                // Clear the dailyDouble object from local storage
                localStorage.removeItem('dailyDouble');

                // Reload the page to reset the styles
                location.reload();
            });
        });
        </script>